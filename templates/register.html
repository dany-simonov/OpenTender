{% extends "base.html" %}

{% block title %}Регистрация | OpenTender{% endblock %}

{% block content %}
<div class="min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-md w-full space-y-8">
        <div>
            <h2 class="mt-6 text-center text-3xl font-extrabold text-gray-900">
                Регистрация
            </h2>
            <p class="mt-2 text-center text-sm text-gray-600">
                Или
                <a href="{{ url_for('login') }}" class="font-medium text-indigo-600 hover:text-indigo-500">
                    войдите, если у вас уже есть аккаунт
                </a>
            </p>
        </div>
        <form class="mt-8 space-y-6" id="registerForm">
            <div class="rounded-md shadow-sm -space-y-px">
                <div>
                    <label for="email" class="sr-only">Email</label>
                    <input id="email" name="email" type="email" required
                        class="appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-t-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm"
                        placeholder="Email">
                </div>
                <div>
                    <label for="password" class="sr-only">Пароль</label>
                    <input id="password" name="password" type="password" required
                        class="appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm"
                        placeholder="Пароль">
                </div>
                <div>
                    <label for="last_name" class="sr-only">Фамилия</label>
                    <input id="last_name" name="last_name" type="text" required
                        class="appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm"
                        placeholder="Фамилия">
                </div>
                <div>
                    <label for="first_name" class="sr-only">Имя</label>
                    <input id="first_name" name="first_name" type="text" required
                        class="appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm"
                        placeholder="Имя">
                </div>
                <div>
                    <label for="middle_name" class="sr-only">Отчество</label>
                    <input id="middle_name" name="middle_name" type="text"
                        class="appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm"
                        placeholder="Отчество">
                </div>
                <div>
                    <label for="phone" class="sr-only">Телефон</label>
                    <input id="phone" name="phone" type="tel" required
                        class="appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm"
                        placeholder="Телефон">
                </div>
                <div>
                    <label for="company_name" class="sr-only">Название компании</label>
                    <input id="company_name" name="company_name" type="text" required
                        class="appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-b-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm"
                        placeholder="Название компании">
                </div>
            </div>

            <div>
                <button type="submit"
                    class="group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    Зарегистрироваться
                </button>
            </div>
        </form>

        <div class="mt-6">
            <div class="relative">
                <div class="absolute inset-0 flex items-center">
                    <div class="w-full border-t border-gray-300"></div>
                </div>
                <div class="relative flex justify-center text-sm">
                    <span class="px-2 bg-gray-50 text-gray-500">
                        Или зарегистрируйтесь через
                    </span>
                </div>
            </div>

            <div class="mt-6 grid grid-cols-3 gap-3">
                <div>
                    <a href="{{ url_for('oauth_authorize', provider='vk') }}"
                        class="w-full inline-flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M15.07 2H8.93C3.33 2 2 3.33 2 8.93V15.07C2 20.67 3.33 22 8.93 22H15.07C20.67 22 22 20.67 22 15.07V8.93C22 3.33 20.67 2 15.07 2ZM18.15 16.27H16.69C16.14 16.27 15.97 15.97 14.86 14.94C13.86 14 13.47 13.74 13.24 13.74C12.93 13.74 12.79 13.88 12.79 14.26V15.69C12.79 16.04 12.67 16.27 11.73 16.27C10.25 16.27 8.65 15.32 7.5 13.59C5.57 10.84 4.96 9.22 4.96 8.75C4.96 8.54 5.08 8.34 5.5 8.34H6.96C7.35 8.34 7.5 8.5 7.63 8.81C8.25 10.27 9.53 12.09 10.08 12.09C10.33 12.09 10.45 11.95 10.45 11.5V10.27C10.4 9.12 9.77 9.03 9.77 8.68C9.77 8.5 9.92 8.34 10.14 8.34H12.5C12.81 8.34 12.95 8.5 12.95 8.81V11.14C12.95 11.57 13.09 11.74 13.14 11.74C13.37 11.74 13.75 11.57 14.45 10.95C15.45 10.07 16.04 8.95 16.04 8.95C16.04 8.95 16.19 8.68 16.5 8.68H17.96C18.37 8.68 18.5 8.84 18.37 9.19C18.19 9.79 16.41 12.09 16.41 12.09C16.41 12.09 16.27 12.34 16.27 12.5C16.27 12.67 16.41 12.84 16.55 13C17.09 13.57 17.91 14.34 18.15 14.67C18.5 15.14 18.37 15.5 18.15 16.27Z"/>
                        </svg>
                    </a>
                </div>

                <div>
                    <a href="{{ url_for('oauth_authorize', provider='yandex') }}"
                        class="w-full inline-flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M2.04 0h19.92c1.12 0 2.04.92 2.04 2.04v19.92c0 1.12-.92 2.04-2.04 2.04H2.04C.92 24 0 23.08 0 21.96V2.04C0 .92.92 0 2.04 0zm9.96 5.5L5.5 18.5h3.96l1.54-3.5h5.5l1.54 3.5h3.96L12 5.5z"/>
                        </svg>
                    </a>
                </div>

                <div>
                    <a href="{{ url_for('oauth_authorize', provider='google') }}"
                        class="w-full inline-flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12.545,10.239v3.821h5.445c-0.712,2.315-2.647,3.972-5.445,3.972c-3.332,0-6.033-2.701-6.033-6.032s2.701-6.032,6.033-6.032c1.498,0,2.866,0.549,3.921,1.453l2.814-2.814C17.503,2.988,15.139,2,12.545,2C7.021,2,2.543,6.477,2.543,12s4.478,10,10.002,10c8.396,0,10.249-7.85,9.426-11.748L12.545,10.239z"/>
                        </svg>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('registerForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = {
        email: document.getElementById('email').value,
        password: document.getElementById('password').value,
        last_name: document.getElementById('last_name').value,
        first_name: document.getElementById('first_name').value,
        middle_name: document.getElementById('middle_name').value,
        phone: document.getElementById('phone').value,
        company_name: document.getElementById('company_name').value
    };
    
    try {
        const response = await fetch('/api/register', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(formData)
        });
        
        const data = await response.json();
        
        if (response.ok) {
            window.location.href = '/';
        } else {
            alert(data.error || 'Ошибка регистрации');
        }
    } catch (error) {
        alert('Произошла ошибка при попытке регистрации');
    }
});
</script>
{% endblock %} 